@page "/Profile/peso"
@using webapi_peso.ViewModels
@inject HttpClient Http
@inject NavigationManager Nav

<div class="municipality-profile">
    <h3 class="fw-bold mb-3">NSRP Applicants</h3>

    <div class="mb-3 d-flex gap-2">
        <button class="btn nsrp-toggle" @onclick="LoadPending">Pending Applicants</button>
        <button class="btn nsrp-toggle" @onclick="LoadVerified">Verified Applicants</button>
        <button class="btn nsrp-toggle" @onclick="GoToAddNSRP">Add NSRP</button>
    </div>

    @if (isLoading)
    {
        <div>Loading...</div>
    }
    else if (nsrpList == null || !nsrpList.Any())
    {
        <div class="alert alert-warning">No records found.</div>
    }
    else
    {
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Full Name</th>
                    <th>Sex</th>
                    <th>Contact</th>
                    <th>Status</th>
                    <th>Registered Date</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in nsrpList)
                {
                    <tr>
                        <td>@item.ApplicantInformation?.FirstName</td>
                        <td>@item.ApplicantInformation?.Gender</td>
                        <td>@item.ApplicantInformation?.CellphoneNumber</td>
                        <td>@item.ApplicantAccount?.IsEmailVerified</td>
                        <td>@item.UserAccount?.DateCreated?.ToString("yyyy-MM-dd")</td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>
@code {
    private List<AccountAndInformationViewModel>? nsrpList;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadPending();
    }

    private async Task LoadPending()
    {
        isLoading = true;
        nsrpList = await Http.GetFromJsonAsync<List<AccountAndInformationViewModel>>("/api/Manager/GetNSRP/pending");
        isLoading = false;
    }

    private async Task LoadVerified()
    {
        isLoading = true;
        nsrpList = await Http.GetFromJsonAsync<List<AccountAndInformationViewModel>>("/api/Manager/GetNSRP/verified");
        isLoading = false;
    }

    private void GoToAddNSRP()
    {
        Nav.NavigateTo("/nsrp/add");
    }

}
